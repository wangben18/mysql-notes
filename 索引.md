## 常见索引模型
-   哈希表
	![[哈希表.jpeg]]
	- 适合等值查询的情景
	- 不适合区间查询
-   有序数组
	- 适合等值查询与区间查询
	- 适合静态存储，不适合插入新数据或删除数据
-   二叉搜索树
	- 由于碎片化，不适合磁盘存取![[二叉搜索树.png]]
-   N叉树
	- B+ 树![[InnoDB的索引组织结构.png]]

## 每一个索引在 InnoDB 里都对应一颗 B+ 树
- 主键索引的叶子节点存储了整行数据，在 InnoDB 里也被称为聚簇索引（clustered index）。
- 非主键索引的叶子节点内容是主键的值，在 InnoDB 里也被称为二级索引（secondary index）。
	- 基于非主键索引的查询需要多扫描一棵索引树（无覆盖索引情况下），所以尽量使用主键索引查询

- 回表
	- 回到主键索引树搜索的过程，我们称为回表。
	- **覆盖索引**可以减少回表次数，提升查询性能

## 索引维护
### 页分裂问题
- 问题描述
	- 需插入的新值在中间位置，需要移动后面的数据
	- 待插入数据页已经满了，将数据移到新数据页
- 如何避免
	- 不使用业务字段做主键，尽量使用自增主键
	- 主键长度越小，普通索引的叶子节点就越小，占用的空间也就越小
	- 适合用业务字段做主键的场景
		- 只有一个索引 & 该索引必须是唯一索引（KV 场景）
		- 没有其他索引就不用考虑叶子节点大小问题，直接用主键搜索减少回表（查询两棵树）操作

唯一索引
- change buffer
	- 在内存中，也会被写入到磁盘
	- 更新数据页时
		- 若在内存中则直接更新
		- 不在内存中，会将更新操作缓存在 change buffer 中。下次查询访问这个数据页时，将数据页读入内存，执行当前数据页相关的 change buffer 中的操作。以此保证数据逻辑正确性
	- merge
		- 将 change buffer 中的操作应用到数据页的过程称为 merge
		- 有后台线程会定期 merge，数据库正常关闭时也会执行 merge 操作
	- 优点：减少读磁盘操作，而且减少读入内存占用的 buffer pool，避免占用内存，提高内存利用率
	- 唯一索引需要判断是否违反唯一性约束，需要读取数据到内存，所以没必要使用 change buffer
	- 通过参数 innodb_change_buffer_max_size 动态设置，单位为占用 buffer pool 的百分比
	- 适用于写多读少的业务场景，如账单类、日志类系统
	- 若业务写入数据后会马上读取，则会立即出触发 merge 操作，反而增加 change buffer 维护代价
	- 特别在使用机械硬盘时，change buffer 的机制收效显著